image: openjdk:11

stages:
  - publish

variables:
  GRADLE_OPTS: "-Dorg.gradle.daemon=false"
  NEXUS_NAME: $NEXUS_USER
  NEXUS_PASSWORD: $NEXUS_PASS

before_script:
  - chmod +x ./gradlew
  - chmod +x ./docker_extractor.sh
  - export GRADLE_USER_HOME=`pwd`/.gradle
  - apt-get update
  - apt-get install -y --no-install-recommends python3.9

extraction:
  stage: .pre
  script:
    - python3 extract.py

distribution:
  stage: publish
  script:
    - ./gradlew build
  artifacts:
    paths:
      - build/distributions/pico*.zip
      - build/distributions/pico*.tar
    expire_in: 1 week
